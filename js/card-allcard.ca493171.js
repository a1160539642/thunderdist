"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[347],{7850:function(e,l,a){a.r(l),a.d(l,{default:function(){return k}});var t=a(6252),s=a(3577);const i=(0,t._)("div",{class:"left-panel"},null,-1),o={class:"right-panel"},c={class:"right-panel-search"},r={key:0},d={key:1},n={key:2},u={key:3};function p(e,l,a,p,m,h){const w=(0,t.up)("el-option"),_=(0,t.up)("el-select"),y=(0,t.up)("el-input"),g=(0,t.up)("el-button"),k=(0,t.up)("el-header"),f=(0,t.up)("el-table-column"),b=(0,t.up)("el-icon-circle-close-filled"),v=(0,t.up)("el-icon"),W=(0,t.up)("el-icon-circle-check-filled"),$=(0,t.up)("el-button-group"),D=(0,t.up)("scTable"),C=(0,t.up)("el-main"),U=(0,t.up)("el-container"),x=(0,t.up)("save-dialog");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(U,null,{default:(0,t.w5)((()=>[(0,t.Wm)(k,null,{default:(0,t.w5)((()=>[i,(0,t._)("div",o,[(0,t._)("div",null,[(0,t.Wm)(_,{class:"w-36",modelValue:m.state,"onUpdate:modelValue":l[0]||(l[0]=e=>m.state=e),placeholder:"状态"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{label:"",value:""}),(0,t.Wm)(w,{label:"已激活",value:"已激活"}),(0,t.Wm)(w,{label:"未激活",value:"未激活"}),(0,t.Wm)(w,{label:"停用",value:"停用"})])),_:1},8,["modelValue"])]),(0,t._)("div",null,[(0,t.Wm)(_,{class:"w-36",modelValue:m.select,"onUpdate:modelValue":l[1]||(l[1]=e=>m.select=e),placeholder:"选择类型"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{label:"",value:""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(this.card_type_list,(e=>((0,t.wg)(),(0,t.j4)(w,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,t._)("div",c,[(0,t.Wm)(y,{modelValue:m.keywords,"onUpdate:modelValue":l[2]||(l[2]=e=>m.keywords=e),placeholder:"输入卡号",clearable:""},null,8,["modelValue"]),(0,t.Wm)(g,{type:"primary",icon:"el-icon-search",onClick:h.upsearch},null,8,["onClick"])])])])),_:1}),(0,t.Wm)(C,{class:"nopadding"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{ref:"table",apiObj:m.apiObj,"row-key":"id",onSelectionChange:h.selectionChange,stripe:""},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{type:"index",width:"50"}),(0,t.Wm)(f,{label:"卡号",prop:"uuid",width:"300"}),(0,t.Wm)(f,{label:"状态",prop:"enable",width:"80"},{default:(0,t.w5)((e=>[0==e.row.sign?((0,t.wg)(),(0,t.iD)("div",r,[(0,t.Wm)(v,{style:{color:"#333333"}},{default:(0,t.w5)((()=>[(0,t.Wm)(b)])),_:1}),(0,t.Uk)(" 停用 ")])):h.time_comp(e.row.end_time)?((0,t.wg)(),(0,t.iD)("div",d,[(0,t.Wm)(v,{style:{color:"#fee082"}},{default:(0,t.w5)((()=>[(0,t.Wm)(b)])),_:1}),(0,t.Uk)(" 已到期 ")])):1==e.row.active?((0,t.wg)(),(0,t.iD)("div",n,[(0,t.Wm)(v,{style:{color:"#67c23a"}},{default:(0,t.w5)((()=>[(0,t.Wm)(W)])),_:1}),(0,t.Uk)(" 已激活 ")])):((0,t.wg)(),(0,t.iD)("div",u,[(0,t.Wm)(v,{style:{color:"#f56c6c"}},{default:(0,t.w5)((()=>[(0,t.Wm)(b)])),_:1}),(0,t.Uk)(" 未激活 ")]))])),_:1}),(0,t.Wm)(f,{label:"卡类型",prop:"card_type_id","show-overflow-tooltip":"",width:"80"},{default:(0,t.w5)((e=>[(0,t._)("div",null,(0,s.zw)(m.card_type_map[e.row.card_type_id]?.name),1)])),_:1}),(0,t.Wm)(f,{label:"备注",prop:"remark",width:"150"}),(0,t.Wm)(f,{label:"到期时间",prop:"end_time",width:"150"}),(0,t.Wm)(f,{label:"上次登录",prop:"login_time",width:"150"}),(0,t.Wm)(f,{label:"激活时间",prop:"recharge_time",width:"150"}),(0,t.Wm)(f,{label:"生成时间",prop:"generation",width:"150"}),(0,t.Wm)(f,{label:"操作",fixed:"right",align:"right",width:"120"},{default:(0,t.w5)((l=>[(0,t.Wm)($,null,{default:(0,t.w5)((()=>[e.$AUTH("card.allcard.stop")?((0,t.wg)(),(0,t.j4)(g,{key:0,text:"",type:"primary",size:"small",onClick:e=>h.stop(l.row.uuid)},{default:(0,t.w5)((()=>[(0,t.Uk)("停用")])),_:2},1032,["onClick"])):(0,t.kq)("",!0),e.$AUTH("card.allcard.remark")?((0,t.wg)(),(0,t.j4)(g,{key:1,text:"",type:"primary",size:"small",onClick:e=>h.remark(l.row.uuid)},{default:(0,t.w5)((()=>[(0,t.Uk)("备注")])),_:2},1032,["onClick"])):(0,t.kq)("",!0)])),_:2},1024)])),_:1})])),_:1},8,["apiObj","onSelectionChange"])])),_:1})])),_:1}),m.dialog.save?((0,t.wg)(),(0,t.j4)(x,{key:0,data:m.card_type_list,ref:"saveDialog",onSuccess:h.handleSuccess,onClosed:l[3]||(l[3]=e=>m.dialog.save=!1)},null,8,["data","onSuccess"])):(0,t.kq)("",!0)],64)}var m=a(7968),h=a(9737),w=a(1348),_={name:"mycard",components:{saveDialog:m["default"]},data(){return{dialog:{save:!1,log:!1},keywords:"",select:"",state:"",apiObj:this.$API.card.allcard.list,selection:[],file:"",card_type_list:[],card_type_map:{}}},created(){this.load_card_type()},methods:{cpoy(e){try{navigator.clipboard.writeText(e),this.$message.success("复制成功")}catch(l){console.log(l),alert("复制失败"+l)}},time_comp(e){let l=Date.parse(e),a=Date.parse(new Date);return l<a},async load_card_type(){try{let e=await this.$API.card.card_type_list.list.get();console.log(e.data),this.card_type_list=e.data;for(let l of this.card_type_list)this.card_type_map[l["id"]]=l}catch(e){}},async stop(e){try{let l={uuid:e};this.$API.card.allcard.stop.post(l),this.$message.success("停用成功")}catch(l){console.log(l)}},async remark(e){h.T.prompt("输入备注","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/.*?/,inputErrorMessage:"无效输入"}).then((async({value:l})=>{try{let a={uuid:e,remark:l};await this.$API.card.allcard.remark.post(a),(0,w.z8)({type:"success",message:"设置成功"})}catch(a){console.log(a)}})).catch((()=>{}))},add(){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open()}))},table_edit(e,l){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("edit").setData(e,l)}))},upsearch(){let e={select:this.select,state:this.state};""==this.keywords?this.$refs.table.reload(e):this.$refs.table.reload({keywords:this.keywords,...e})},selectionChange(e){this.selection=e},handleSuccess(){this.$refs.table.getData(),this.$store.dispatch("fetch_cash")}}},y=a(3744);const g=(0,y.Z)(_,[["render",p]]);var k=g}}]);