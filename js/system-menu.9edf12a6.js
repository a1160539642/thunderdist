"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[251],{828:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var l=a(6252),i=a(3577);const s={class:"flex-c"};function n(e,t,a,n,o,d){const r=(0,l.up)("el-table-column"),c=(0,l.up)("el-switch"),h=(0,l.up)("el-button"),u=(0,l.up)("el-button-group"),m=(0,l.up)("scTable"),g=(0,l.up)("el-main"),p=(0,l.up)("el-popconfirm"),f=(0,l.up)("el-footer"),w=(0,l.up)("el-container"),v=(0,l.up)("save-dialog"),b=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(g,{class:"nopadding"},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{ref:"table",data:o.data,"row-key":"name",onSelectionChange:d.selectionChange,hidePagination:"",hideDo:""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{label:"菜单名称",prop:"meta",width:"200"},{default:(0,l.w5)((e=>[(0,l._)("span",null,(0,i.zw)(e.row.meta.title),1)])),_:1}),(0,l.Wm)(r,{label:"状态",prop:"enble",width:"150"},{default:(0,l.w5)((e=>[(0,l.Wm)(c,{modelValue:e.row.meta.enble,"onUpdate:modelValue":t=>e.row.meta.enble=t,onChange:t=>d.changeSwitch(t,e.row),loading:e.row.$switch_status,"active-value":!0,"inactive-value":!1},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])])),_:1}),(0,l.Wm)(r,{label:"权限名称",prop:"name",width:"150"}),(0,l.Wm)(r,{label:"路径",prop:"path","min-width":"150"}),(0,l.Wm)(r,{label:"细分权限",prop:"meta",width:"300"},{default:(0,l.w5)((e=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.row.meta.roles,(e=>((0,l.wg)(),(0,l.iD)("span",{class:"m-1 text-gray-400",key:e.name},(0,i.zw)(e.title),1)))),128))])),_:1}),(0,l.Wm)(r,{label:"操作",fixed:"right",align:"right",width:"170"},{default:(0,l.w5)((e=>[(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Wm)(h,{text:"",type:"primary",size:"small",onClick:t=>d.table_edit(e.row,e.$index)},{default:(0,l.w5)((()=>[(0,l.Uk)("编辑")])),_:2},1032,["onClick"]),(0,l.Wm)(h,{text:"",type:"primary",size:"small",onClick:t=>d.move(e,-1)},{default:(0,l.w5)((()=>[(0,l.Uk)("上移")])),_:2},1032,["onClick"]),(0,l.Wm)(h,{text:"",type:"primary",size:"small",onClick:t=>d.move(e,1)},{default:(0,l.w5)((()=>[(0,l.Uk)("下移")])),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data","onSelectionChange"])])),_:1}),(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l._)("div",s,[(0,l.Wm)(h,{type:"primary",onClick:d.save},{default:(0,l.w5)((()=>[(0,l.Uk)("保存修改")])),_:1},8,["onClick"]),(0,l.Wm)(p,{title:"确定重置修改吗？",onConfirm:d.load},{reference:(0,l.w5)((()=>[(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Uk)("重置")])),_:1})])),_:1},8,["onConfirm"])])])),_:1})])),_:1})),[[b,o.loading]]),o.dialog.save?((0,l.wg)(),(0,l.j4)(v,{key:0,ref:"saveDialog",onSuccess:d.handleSaveSuccess,onClosed:t[0]||(t[0]=e=>o.dialog.save=!1)},null,8,["onSuccess"])):(0,l.kq)("",!0)],64)}var o=a(9977),d={name:"system_menu",components:{saveDialog:o["default"]},data(){return{dialog:{save:!1},data:[],apiObj:this.$API.system.menu.list,selection:[],search:{keyword:null},loading:!1}},methods:{add(){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open()}))},async save(){try{this.loading=!0;let e={config_value:this.data};await this.$API.system.menu.updata.post(e),this.$message.success("保存成功,所有账号重新登录后生效")}catch(e){console.log(e)}finally{this.loading=!1}},async load(){try{this.$refs.table.loading=!0;let e=await this.$API.system.menu.list.get();this.data=e.data}catch(e){console.log(e)}finally{this.$refs.table.loading=!1}},move(e,t){let a=e.row.name.split("."),l=this.get_index(this.data,a[0]);if(1!=a.length){let a=this.data[l]["children"],i=this.get_index(a,e.row.name),s=i+t;if(s<0||s>=a.length)return void console.log("边界,无法调整位置");let n=a.splice(i,1);a.splice(s,0,n[0])}else{let e=l+t;if(e<0||e>=this.data.length)return void console.log("边界,无法调整位置");let a=this.data.splice(l,1);this.data.splice(e,0,a[0])}},get_index(e,t,a=0){for(let l of e){if(l.name==t)return a;a++}},table_edit(e,t){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("edit").setData(e,t)}))},table_show(e){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("show").setData(e)}))},async table_del(e){var t={id:e.id},a=await this.$API.demo.post.post(t);200==a.code?(this.$refs.table.refresh(),this.$message.success("删除成功")):this.$alert(a.message,"提示",{type:"error"})},async batch_del(){this.$confirm(`确定删除选中的 ${this.selection.length} 项吗？如果删除项中含有子集将会被一并删除`,"提示",{type:"warning"}).then((()=>{const e=this.$loading();this.$refs.table.refresh(),e.close(),this.$message.success("操作成功")})).catch((()=>{}))},selectionChange(e){this.selection=e},upsearch(){},filterTree(e){var t=null;function a(l){l.forEach((l=>{l.id==e&&(t=l),l.children&&a(l.children)}))}return a(this.$refs.table.tableData),t},handleSaveSuccess(e,t){let a=0;for(let l in this.data){if(t==a)return void this.data.splice(l,1,e);if(this.data[l].children)for(let i in this.data[l].children)if(a+=1,t==a)return void this.data[l].children.splice(i,1,e);a+=1}},async changeSwitch(e,t){t.meta.enble=e}},mounted(){this.load()}},r=a(3744);const c=(0,r.Z)(d,[["render",n]]);var h=c}}]);