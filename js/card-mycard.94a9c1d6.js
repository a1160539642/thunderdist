"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[419],{2656:function(e,a,t){t.r(a),t.d(a,{default:function(){return f}});var l=t(6252),s=t(3577);const i={class:"left-panel"},c={class:"right-panel"},o={class:"right-panel-search"},r={key:0},d={key:1},n={key:2},p={key:3};function u(e,a,t,u,h,m){const w=(0,l.up)("el-button"),y=(0,l.up)("el-option"),_=(0,l.up)("el-select"),g=(0,l.up)("el-input"),f=(0,l.up)("el-header"),k=(0,l.up)("el-table-column"),b=(0,l.up)("el-icon-circle-close-filled"),v=(0,l.up)("el-icon"),W=(0,l.up)("el-icon-circle-check-filled"),$=(0,l.up)("el-button-group"),D=(0,l.up)("scTable"),C=(0,l.up)("el-main"),U=(0,l.up)("el-container"),T=(0,l.up)("save-dialog");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l._)("div",i,[e.$AUTH("card.mycard.gen")?((0,l.wg)(),(0,l.j4)(w,{key:0,type:"primary",icon:"el-icon-plus",onClick:m.add},{default:(0,l.w5)((()=>[(0,l.Uk)("生成卡密")])),_:1},8,["onClick"])):(0,l.kq)("",!0)]),(0,l._)("div",c,[(0,l._)("div",null,[(0,l.Wm)(_,{class:"w-36",modelValue:h.state,"onUpdate:modelValue":a[0]||(a[0]=e=>h.state=e),placeholder:"状态"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{label:"",value:""}),(0,l.Wm)(y,{label:"已激活",value:"已激活"}),(0,l.Wm)(y,{label:"未激活",value:"未激活"}),(0,l.Wm)(y,{label:"停用",value:"停用"})])),_:1},8,["modelValue"])]),(0,l._)("div",null,[(0,l.Wm)(_,{class:"w-36",modelValue:h.select,"onUpdate:modelValue":a[1]||(a[1]=e=>h.select=e),placeholder:"选择类型"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{label:"",value:""}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(this.card_type_list,(e=>((0,l.wg)(),(0,l.j4)(y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,l._)("div",o,[(0,l.Wm)(g,{modelValue:h.keywords,"onUpdate:modelValue":a[2]||(a[2]=e=>h.keywords=e),placeholder:"输入卡号",clearable:""},null,8,["modelValue"]),(0,l.Wm)(w,{type:"primary",icon:"el-icon-search",onClick:m.upsearch},null,8,["onClick"])])])])),_:1}),(0,l.Wm)(C,{class:"nopadding"},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{ref:"table",apiObj:h.apiObj,"row-key":"id",onSelectionChange:m.selectionChange,stripe:""},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{type:"index",width:"50"}),(0,l.Wm)(k,{label:"卡号",prop:"uuid",width:"300"}),(0,l.Wm)(k,{label:"状态",prop:"enable",width:"80"},{default:(0,l.w5)((e=>[0==e.row.sign?((0,l.wg)(),(0,l.iD)("div",r,[(0,l.Wm)(v,{style:{color:"#333333"}},{default:(0,l.w5)((()=>[(0,l.Wm)(b)])),_:1}),(0,l.Uk)(" 停用 ")])):m.time_comp(e.row.end_time)?((0,l.wg)(),(0,l.iD)("div",d,[(0,l.Wm)(v,{style:{color:"#fee082"}},{default:(0,l.w5)((()=>[(0,l.Wm)(b)])),_:1}),(0,l.Uk)(" 已到期 ")])):1==e.row.active?((0,l.wg)(),(0,l.iD)("div",n,[(0,l.Wm)(v,{style:{color:"#67c23a"}},{default:(0,l.w5)((()=>[(0,l.Wm)(W)])),_:1}),(0,l.Uk)(" 已激活 ")])):((0,l.wg)(),(0,l.iD)("div",p,[(0,l.Wm)(v,{style:{color:"#f56c6c"}},{default:(0,l.w5)((()=>[(0,l.Wm)(b)])),_:1}),(0,l.Uk)(" 未激活 ")]))])),_:1}),(0,l.Wm)(k,{label:"卡类型",prop:"card_type_id","show-overflow-tooltip":"",width:"80"},{default:(0,l.w5)((e=>[(0,l._)("div",null,(0,s.zw)(h.card_type_map[e.row.card_type_id]?.name),1)])),_:1}),(0,l.Wm)(k,{label:"备注",prop:"remark",width:"150"}),(0,l.Wm)(k,{label:"到期时间",prop:"end_time",width:"150"}),(0,l.Wm)(k,{label:"上次登录",prop:"login_time",width:"150"}),(0,l.Wm)(k,{label:"激活时间",prop:"recharge_time",width:"150"}),(0,l.Wm)(k,{label:"生成时间",prop:"generation",width:"150"}),(0,l.Wm)(k,{label:"操作",fixed:"right",align:"right",width:"120"},{default:(0,l.w5)((a=>[(0,l.Wm)($,null,{default:(0,l.w5)((()=>[e.$AUTH("card.mycard.stop")?((0,l.wg)(),(0,l.j4)(w,{key:0,text:"",type:"primary",size:"small",onClick:e=>m.stop(a.row.uuid)},{default:(0,l.w5)((()=>[(0,l.Uk)("停用")])),_:2},1032,["onClick"])):(0,l.kq)("",!0),e.$AUTH("card.mycard.remark")?((0,l.wg)(),(0,l.j4)(w,{key:1,text:"",type:"primary",size:"small",onClick:e=>m.remark(a.row.uuid)},{default:(0,l.w5)((()=>[(0,l.Uk)("备注")])),_:2},1032,["onClick"])):(0,l.kq)("",!0)])),_:2},1024)])),_:1})])),_:1},8,["apiObj","onSelectionChange"])])),_:1})])),_:1}),h.dialog.save?((0,l.wg)(),(0,l.j4)(T,{key:0,data:h.card_type_list,ref:"saveDialog",onSuccess:m.handleSuccess,onClosed:a[3]||(a[3]=e=>h.dialog.save=!1)},null,8,["data","onSuccess"])):(0,l.kq)("",!0)],64)}var h=t(4186),m=t(9737),w=t(1348),y={name:"mycard",components:{saveDialog:h["default"]},data(){return{dialog:{save:!1,log:!1},keywords:"",select:"",state:"",apiObj:this.$API.card.mycard.list,selection:[],file:"",card_type_list:[],card_type_map:{}}},created(){this.load_card_type()},methods:{cpoy(e){try{navigator.clipboard.writeText(e),this.$message.success("复制成功")}catch(a){console.log(a),alert("复制失败"+a)}},time_comp(e){let a=Date.parse(e),t=Date.parse(new Date);return a<t},async load_card_type(){try{let e=await this.$API.card.card_type_list.list.get();console.log(e.data),this.card_type_list=e.data;for(let a of this.card_type_list)this.card_type_map[a["id"]]=a}catch(e){}},async stop(e){try{let a={uuid:e};this.$API.card.mycard.stop.post(a),this.$message.success("停用成功")}catch(a){console.log(a)}},async remark(e){m.T.prompt("输入备注","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/.*?/,inputErrorMessage:"无效输入"}).then((async({value:a})=>{try{let t={uuid:e,remark:a};await this.$API.card.mycard.remark.post(t),(0,w.z8)({type:"success",message:"设置成功"})}catch(t){console.log(t)}})).catch((()=>{}))},add(){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open()}))},table_edit(e,a){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("edit").setData(e,a)}))},async table_del(e,a){var t={id:e.id};try{await this.$API.params.technical.del.post(t),this.$refs.table.tableData.splice(a,1),this.$message.success("删除成功")}catch(l){}},async batch_del(){this.$confirm(`确定删除选中的 ${this.selection.length} 项吗？`,"提示",{type:"warning"}).then((()=>{const e=this.$loading();this.selection.forEach((e=>{this.$refs.table.tableData.forEach(((a,t)=>{e.id===a.id&&this.$refs.table.tableData.splice(t,1)}))})),e.close(),this.$message.success("操作成功")})).catch((()=>{}))},upsearch(){let e={select:this.select,state:this.state};""==this.keywords?this.$refs.table.reload(e):this.$refs.table.reload({keywords:this.keywords,...e})},selectionChange(e){this.selection=e},handleSuccess(){this.$refs.table.getData(),this.$store.dispatch("fetch_cash")}}},_=t(3744);const g=(0,_.Z)(y,[["render",u]]);var f=g}}]);